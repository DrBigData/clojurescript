<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
  "http://www.w3.org/TR/html4/strict.dtd">
<html>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <head>
    <title>ClojureScript REPL</title>
    <style type="text/css">
      body {
        font-family: Monaco,monospace;
        font-size: 10pt;
      }
      .pad {
        height: 20em;
      }
      #log {
        height: 20em;
        overflow: auto;
        white-space: pre-wrap;
      }
      #log table {
        border-collapse: collapse;
      }
      #log td {
        vertical-align: top;
        padding: 0;
      }
      .ns {
        float: left;
      }
      .cg {
        color: #00b;
      }
      .err {
        color: #b00;
      }
      .rtn {
        color: #000;
      }
      textarea#input {
        padding: 0;
        margin: 0;
        border: none;
        width: 90%;
        height: 6em;
        background: #f3f3f3;
      }
    </style>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script type="text/javascript" src="out/goog/base.js"></script>
    <script type="text/javascript" src="webrepl.js"></script>
    <script type="text/javascript">goog.require('cljs.analyzer');</script>
    <script type="text/javascript">goog.require('cljs.compiler');</script>
    <script type="text/javascript">goog.require('cljs.reader');</script>
    <script type="text/javascript">goog.require('bs');</script>
    <script type="text/javascript">goog.require('webrepl');</script>
    <script>
        /*
      cljs.core._STAR_print_fn_STAR_ = function (x) {
          //$("#out").append(x);
          console.log("out:", x);
      };
      */

      // Setup initial namespaces and environment for the analyzer
      cljs.analyzer.namespaces = cljs.namespaces;
      cljs.user = {};
      env = cljs.analyzer.empty_env();

      function handle_exception(e) {
          window.e = e;
          //$("#out").text($("#out").text() + e.stack);
          throw(e);
      };

      function ana (str) { try { return cljs.analyzer.analyze(env, cljs.reader.read_string(str)) } catch (e) { handle_exception(e); } }
      function comp (str) { try { return cljs.compiler.emit_str(ana(str)) } catch (e) { handle_exception(e); } }
      function re (str) { try { return eval(comp(str)) } catch (e) { handle_exception(e); } }
      //function re (str) { try { return eval(cljs.compiler.emit_str(ana(str))) } catch (e) { handle_exception(e); } }
      function rep (str) { try { cljs.core.prn(re(str)) } catch (e) { handle_exception(e); } }

      re("(set! js/env (assoc js/env :context :expr))");

      /*
      $("#eval").click(function () {
          var forms = $("#forms")[0].value;
          var ret = re(forms);
          $("#ret").text(ret);
          console.log("forms", forms, "ret:", ret);
      });
      */
    </script>
  </head>
  <body>
    <div id="log">
      <div class="pad"></div>
    </div>
    <div class="ns cg">
      user=&gt;&nbsp;<br />
      <img id="status" src="blank.gif">
    </div>
    <textarea id="input"></textarea>
    <!--
    <applet id="applet" code="clojure.contrib.clojurescript.applet"
      archive="clojurescript-applet.jar" width="100" height="100">
    </applet>
    -->
  </body>
</html>
